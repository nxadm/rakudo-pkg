language: generic
env:
  global:
  - RAKUDO_VERSION="2018.02.1"
  - NQP_VERSION="2018.02"
  - MOARVM_VERSION="2018.02"
  - REVISION="01"
  - PATH=/opt/rakudo-pkg/bin:$PATH
  - RAKUDO_DEB="https://github.com/nxadm/rakudo-pkg/releases/download/v2018.01/rakudo-pkg-Ubuntu14.04_2018.01-01_amd64.deb"
  matrix:
  - OS=alpine   ARCH=amd64 VERSION=3.6
  - OS=alpine   ARCH=amd64 VERSION=3.7
  - OS=centos   ARCH=amd64 VERSION=7
  - OS=debian   ARCH=amd64 VERSION=8
  - OS=debian   ARCH=amd64 VERSION=9
  - OS=fedora   ARCH=amd64 VERSION=25
  - OS=fedora   ARCH=amd64 VERSION=26
  - OS=fedora   ARCH=amd64 VERSION=27
  - OS=opensuse ARCH=amd64 VERSION=42.3
  - OS=ubuntu   ARCH=amd64 VERSION=14.04
  - OS=ubuntu   ARCH=amd64 VERSION=16.04
  - OS=ubuntu   ARCH=amd64 VERSION=17.10
  - OS=ubuntu   ARCH=amd64 VERSION=14.04
  - OS=ubuntu   ARCH=i386 VERSION=16.04
  - OS=ubuntu   ARCH=i386 VERSION=17.10
sudo: required
services:
- docker
install: wget $RAKUDO_DEB && sudo dpkg -i *.deb
script:
- bin/create-img.p6 docker/Dockerfile-${OS}-${ARCH}-${VERSION} && bin/create-pkg.p6
  rakudo-pkg/$OS-$ARCH:$VERSION --rakudo-version=$RAKUDO_VERSION --nqp-version=$NQP_VERSION
  --moarvm-version=$MOARVM_VERSION --rev=$REVISION
before_deploy:
- git config --local user.name "brian d foy"
- git config --local user.email "brian.d.foy@gmail.com"
- git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"deploy:
deploy:
  provider: releases
  api_key:
    secure: WermANxkGI2hlcU4gSJ+W8DbLgeR5OBxn9QtoH5TebgPNRVDXhgTCM7n1wQllZBtALIgU0EPUHHOCMORrZ+PJBqVIAVABR4ScHFDaunzMibdG0oboXTay9MMu9JxurdBYgll6sm5ozZPXeX+5FlMyWAyrOWL+fvrPk716Gll2ex/0ddgcSjn1G3J/C7T3OBv59Pgl/Amavtev0sRldvCmLpXChDkULWRDWsTDq5cmJaJbQqQKA/zTXvgW5jnBSTl59OdcM73qlIqK/hY9ESibDQYVAeYhXNI8RPu/bA40gunh2dW/gZPrptyw8yGUoHD4fE3SE+wAX9ymwN9/TPNYjBO3Hi1HJ92okWzcOK9nIVyLB02lRX4KvCekcWeOqnQZ5Y5u41ZunFxMijDiNH6c+y5Umwj5EjCWWi5w+u0QBfd9UPRQ95xG6IhWfpo1VF/+7jkcyT6knku7EGThIELlSSbd3kA5N6PdywD4BcaPhlwy9RRryudx3JUJ2I1Y2b6xqVnUaJM4pPNqcB9hhXVTwLpYQL/CoG0A0fGmwSJEpriYTM9nFG7cG9JVBdQFoY9Yqs3LZdZ97WOLQj9YzeUpCbp1y0ucVrra9n729ekt6Wb2OLL4SYBn2cA/224TicNpjrdWqlcM386EDjnEw28rUNDyG5oEOffTKK4ePSKgV4=
  file_glob: true
  file: '"/var/tmp/rakudo-pkg/*"'
  skip_cleanup: true
  on:
    repo: briandfoy/rakudo-pkg
    tags: true
